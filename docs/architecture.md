# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî Wiki

> –û–±–Ω–æ–≤–ª–µ–Ω–æ: 2026-02-24

## –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```mermaid
graph TB
    Client["üñ• Web Client (React + AntDesign)"]
    API["‚öôÔ∏è FastAPI Backend"]
    Auth["üîê Casbin RBAC"]
    DB["üóÑ PostgreSQL (ltree, FTS)"]
    S3["üì¶ MinIO (S3 Storage)"]

    Client -- API Requests --> API
    Client -- Presigned URL PUT --> S3
    API -- Read/Write --> DB
    API -- Check Access --> Auth
    API -- Generate Temp Link --> S3
```

## –¢–∏–ø –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ú–æ–Ω–æ–ª–∏—Ç–Ω–æ–µ —è–¥—Ä–æ (FastAPI) —Å —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–æ–≤ –≤ S3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Isolated Schema Multi-Tenancy** (–æ–¥–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ö–µ–º—ã (schema) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞). –ö–æ–Ω—Ç–µ–∫—Å—Ç –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ (tenant) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Middleware.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–∑–∞—Ö (frontend + backend codebases).

## –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

| –ú–æ–¥—É–ª—å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
|--------|----------------|-------------|
| Middleware/Auth | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Tenant ID, JWT-–ø—Ä–æ–≤–µ—Ä–∫–∞. | Pydantic, FastAPI. |
| RBAC (Casbin) | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π (—Ä–æ–ª–∏, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ Tenant). | sqlalchemy, pycasbin. |
| Pages Tree | –û–ø–µ—Ä–∞—Ü–∏–∏ CRUD —Å \`ltree\`, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ (–¥–æ 4 —É—Ä.). | PostgreSQL \`ltree\`. |
| Search | –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å –≥–∏–±—Ä–∏–¥–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π. | Postgres FTS (\`tsvector\`). |
| Media S3 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (Presigned URL) –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏/—á—Ç–µ–Ω–∏—è –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤. | boto3 / minio. |

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (–ö–ª—é—á–µ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏)

```mermaid
erDiagram
    TENANT ||--o{ PAGE : contains
    PAGE ||--o{ PAGE : children_via_ltree
    PAGE {
        int id PK
        int tenant_id FK
        string ltree_path "–ü—É—Ç—å —É–∑–ª–∞"
        tsvector search_vector "–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç"
        string slug "–ö–µ–±–∞–±-–∫–µ–π—Å URL"
    }
    TENANT {
        int id PK
    }
```

## API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | Auth |
|-------|------|----------|------|
| GET | \`/api/v1/pages\` | –ü–æ–ª—É—á–∏—Ç—å –≤—Å—ë –¥–µ—Ä–µ–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü —Ç–µ–∫—É—â–µ–≥–æ tenant (treeData) | –î–∞ |
| GET | \`/api/v1/pages/{{slug}}\` | –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | –î–∞ / –ü—É–±–ª.–¢–æ–∫–µ–Ω |
| POST | \`/api/v1/media/upload-url\` | –ü–æ–ª—É—á–∏—Ç—å Presigned URL MinIO | –î–∞ |

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
JWT Bearer ÌÜ†–∫–µ–Ω—ã. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é Casbin pycasbin (–î–æ–º–µ–Ω—ã: tenant1, –†–æ–ª–∏: admin, editor, viewer).
